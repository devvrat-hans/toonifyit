# TOON Format Implementation Guide for JavaScript Developers: Complete Tutorial with Node.js & Express

## Introduction

Building modern JavaScript applications means constantly dealing with data serialization. Whether you're **converting JSON to TOON**, optimizing LLM API calls, or reducing token costs on ChatGPT/Claude integrations, JavaScript developers need practical, production-ready implementation guides.

This comprehensive guide walks you through implementing the **TOON format** (Token-Oriented Object Notation) in your JavaScript applications. You'll learn how to integrate the **TOON JavaScript library**, work with Node.js, build Express.js APIs optimized for LLMs, and achieve **30-60% token reduction** compared to traditional JSON encoding.

**Key Benchmarks:**
- **Token savings:** 50-60% on uniform tabular data
- **LLM accuracy:** 73.9% with TOON vs 69.7% with JSON
- **Implementation time:** <10 minutes to integrate
- **Production-ready:** Used by teams scaling LLM applications

---

## What is TOON Format and Why JavaScript Developers Should Care

### The Problem: JSON's Token Inefficiency

When sending data to Large Language Model APIs (OpenAI, Anthropic, Google), every token costs money. Consider this customer dataset in JSON:

```json
{
  "customers": [
    { "id": 1, "name": "Alice Smith", "email": "alice@example.com", "status": "active", "plan": "premium" },
    { "id": 2, "name": "Bob Johnson", "email": "bob@example.com", "status": "active", "plan": "basic" },
    { "id": 3, "name": "Charlie Brown", "email": "charlie@example.com", "status": "inactive", "plan": "free" }
  ]
}
```

**This JSON uses 187 tokens** to represent just 3 customer records.

### The Solution: TOON Format

The **exact same data in TOON format:**

```
customers[3]{id,name,email,status,plan}:
  1,Alice Smith,alice@example.com,active,premium
  2,Bob Johnson,bob@example.com,active,basic
  3,Charlie Brown,charlie@example.com,inactive,free
```

**This TOON uses only 72 tokens** — a **61.5% reduction**.

At scale with 1,000 API calls sending 100 customer records each:
- **JSON cost:** $48.50/month (at GPT-4 pricing)
- **TOON cost:** $18.75/month
- **Savings:** $29.75/month or **$357/year**

### Why Modern JavaScript Developers Need TOON

✅ **LLM Cost Optimization** - Direct impact on API bills
✅ **Faster Inference** - Fewer tokens = faster model response
✅ **Better Accuracy** - Explicit structure helps models parse data correctly
✅ **Drop-in Replacement** - Works seamlessly with existing JavaScript workflows
✅ **Growing Ecosystem** - Official Node.js library with full feature support

---

## Installation & Setup: Getting TOON into Your Project

### Step 1: Install the TOON Package

The official TOON JavaScript library is available on npm as `@toon-format/toon`.

**Using npm:**
```bash
npm install @toon-format/toon
```

**Using yarn:**
```bash
yarn add @toon-format/toon
```

**Using pnpm:**
```bash
pnpm add @toon-format/toon
```

### Step 2: Import and Verify Installation

**CommonJS syntax:**
```javascript
const { encode, decode } = require('@toon-format/toon');

const data = { users: [{ id: 1, name: 'Alice' }] };
const toonString = encode(data);
console.log(toonString);
```

**ES6 module syntax (recommended):**
```javascript
import { encode, decode } from '@toon-format/toon';

const data = { users: [{ id: 1, name: 'Alice' }] };
const toonString = encode(data);
console.log(toonString);
```

**For ES6 modules in Node.js**, ensure your `package.json` includes:
```json
{
  "type": "module"
}
```

### Step 3: Test Your Installation

Create a test file (`test-toon.js`):

```javascript
import { encode, decode } from '@toon-format/toon';

// Sample data
const testData = {
  users: [
    { id: 1, name: 'Alice', role: 'admin' },
    { id: 2, name: 'Bob', role: 'user' }
  ]
};

// Test encoding
console.log('Original JSON:');
console.log(JSON.stringify(testData, null, 2));

console.log('\nEncoded TOON:');
const encoded = encode(testData);
console.log(encoded);

// Test decoding
console.log('\nDecoded back to JSON:');
const decoded = decode(encoded);
console.log(JSON.stringify(decoded, null, 2));
```

**Run the test:**
```bash
node test-toon.js
```

**Expected output:**
```
Original JSON:
{
  "users": [
    { "id": 1, "name": "Alice", "role": "admin" },
    { "id": 2, "name": "Bob", "role": "user" }
  ]
}

Encoded TOON:
users[2]{id,name,role}:
  1,Alice,admin
  2,Bob,user

Decoded back to JSON:
{
  "users": [
    { "id": 1, "name": "Alice", "role": "admin" },
    { "id": 2, "name": "Bob", "role": "user" }
  ]
}
```

---

## Core TOON Implementation Patterns

### Pattern 1: Basic JSON to TOON Conversion

The simplest use case: converting a JSON object to TOON format.

```javascript
import { encode } from '@toon-format/toon';

// Example: E-commerce products
const products = {
  items: [
    { sku: 'PROD001', name: 'Laptop', price: 999, stock: 45 },
    { sku: 'PROD002', name: 'Mouse', price: 29, stock: 150 },
    { sku: 'PROD003', name: 'Keyboard', price: 79, stock: 87 }
  ]
};

const toonOutput = encode(products);
console.log(toonOutput);
```

**Output:**
```
items[3]{sku,name,price,stock}:
  PROD001,Laptop,999,45
  PROD002,Mouse,29,150
  PROD003,Keyboard,79,87
```

**Use case:** Sending product catalogs to LLMs for recommendations, price comparisons, or inventory analysis.

---

### Pattern 2: Complex Objects with Nested Data

When you have nested objects or mixed data structures:

```javascript
import { encode } from '@toon-format/toon';

const complexData = {
  store: {
    name: "TechMart",
    location: "Downtown",
    sales: [
      { date: "2025-01-01", revenue: 2500, units: 45 },
      { date: "2025-01-02", revenue: 3100, units: 52 },
      { date: "2025-01-03", revenue: 2800, units: 48 }
    ]
  }
};

const toon = encode(complexData);
console.log(toon);
```

**Output:**
```
store:
  name: TechMart
  location: Downtown
  sales[3]{date,revenue,units}:
    2025-01-01,2500,45
    2025-01-02,3100,52
    2025-01-03,2800,48
```

**Key behavior:** TOON automatically detects tabular arrays (uniform objects) and encodes them efficiently, while preserving nested structures.

---

### Pattern 3: Handling Non-Uniform Data

When objects in an array have different fields, TOON switches to list format:

```javascript
import { encode } from '@toon-format/toon';

// Mixed data with varying fields
const mixedData = {
  events: [
    { id: 1, type: "login", timestamp: "2025-01-01T10:00:00" },
    { id: 2, type: "purchase", amount: 99.99, timestamp: "2025-01-01T10:05:00" },
    { id: 3, type: "logout", timestamp: "2025-01-01T10:10:00" }
  ]
};

const toon = encode(mixedData);
console.log(toon);
```

**Output:**
```
events[3]:
  - id: 1, type: login, timestamp: 2025-01-01T10:00:00
  - id: 2, type: purchase, amount: 99.99, timestamp: 2025-01-01T10:05:00
  - id: 3, type: logout, timestamp: 2025-01-01T10:10:00
```

**Performance note:** Non-uniform arrays use list format (similar to JSON), achieving 10-20% token savings instead of the full 50-60%.

---

### Pattern 4: Round-Trip Conversion (JSON ↔ TOON)

Encoding and decoding data while preserving structure:

```javascript
import { encode, decode } from '@toon-format/toon';

// Original JavaScript object
const original = {
  users: [
    { id: 1, email: "alice@example.com", verified: true },
    { id: 2, email: "bob@example.com", verified: false },
    { id: 3, email: "charlie@example.com", verified: true }
  ]
};

// Encode to TOON
const toonString = encode(original);
console.log('TOON format:');
console.log(toonString);

// Decode back to JavaScript object
const restored = decode(toonString);
console.log('\nRestored JavaScript object:');
console.log(JSON.stringify(restored, null, 2));

// Verify they're identical
console.log('\nAre they identical?', JSON.stringify(original) === JSON.stringify(restored));
```

**Output:**
```
TOON format:
users[3]{id,email,verified}:
  1,alice@example.com,true
  2,bob@example.com,false
  3,charlie@example.com,true

Restored JavaScript object:
{
  "users": [
    { "id": 1, "email": "alice@example.com", "verified": true },
    { "id": 2, "email": "bob@example.com", "verified": false },
    { "id": 3, "email": "charlie@example.com", "verified": true }
  ]
}

Are they identical? true
```

**Use case:** Store data in TOON format in databases, then convert back to JSON for client responses—reducing storage and transmission costs.

---

## Advanced Configuration Options

### Option 1: Custom Delimiters

By default, TOON uses commas. You can customize this for different use cases:

**Tab-delimited (often more token-efficient):**
```javascript
import { encode } from '@toon-format/toon';

const data = {
  metrics: [
    { date: "2025-01-01", views: 1200, clicks: 45, conversions: 8 },
    { date: "2025-01-02", views: 1450, clicks: 52, conversions: 9 }
  ]
};

const toonTab = encode(data, { delimiter: '\t' });
console.log(toonTab);
```

**Output:**
```
metrics[2]{date	views	clicks	conversions}:
  2025-01-01	1200	45	8
  2025-01-02	1450	52	9
```

**Pipe-delimited (alternative):**
```javascript
const toonPipe = encode(data, { delimiter: '|' });
console.log(toonPipe);
```

**Output:**
```
metrics[2]{date|views|clicks|conversions}:
  2025-01-01|1200|45|8
  2025-01-02|1450|52|9
```

**When to use each:**
- **Comma (`,`)**: Default, most compatible
- **Tab (`\t`)**: Often saves 5-10% more tokens than commas
- **Pipe (`|`)**: When data contains commas naturally

---

### Option 2: Indentation Control

Control spacing for readability vs. token efficiency:

```javascript
import { encode } from '@toon-format/toon';

const data = {
  users: [
    { id: 1, name: 'Alice' },
    { id: 2, name: 'Bob' }
  ]
};

// 2-space indentation (default)
const toon2 = encode(data, { indent: 2 });
console.log('2-space indent:');
console.log(toon2);

// 1-space indentation (more compact)
const toon1 = encode(data, { indent: 1 });
console.log('\n1-space indent:');
console.log(toon1);

// 4-space indentation (more readable)
const toon4 = encode(data, { indent: 4 });
console.log('\n4-space indent:');
console.log(toon4);
```

**Output:**
```
2-space indent:
users[2]{id,name}:
  1,Alice
  2,Bob

1-space indent:
users[2]{id,name}:
 1,Alice
 2,Bob

4-space indent:
users[2]{id,name}:
    1,Alice
    2,Bob
```

**Performance tip:** Use `indent: 1` when sending to LLMs to minimize whitespace tokens.

---

### Option 3: Combining Options

```javascript
import { encode } from '@toon-format/toon';

const analyticsData = {
  pageViews: [
    { date: "2025-01-01", page: "/home", views: 5420 },
    { date: "2025-01-01", page: "/about", views: 2103 },
    { date: "2025-01-01", page: "/contact", views: 987 }
  ]
};

// Maximum token efficiency: tab delimiter, 1-space indent
const optimized = encode(analyticsData, { 
  delimiter: '\t', 
  indent: 1 
});

console.log('Optimized for LLM APIs:');
console.log(optimized);

// Token counts
console.log('\nToken comparison:');
const jsonTokens = JSON.stringify(analyticsData).length / 4; // approximate
const toonTokens = optimized.length / 4; // approximate
console.log(`JSON tokens: ~${Math.ceil(jsonTokens)}`);
console.log(`TOON tokens: ~${Math.ceil(toonTokens)}`);
console.log(`Savings: ~${Math.round((1 - toonTokens / jsonTokens) * 100)}%`);
```

---

## Integrating TOON with Node.js Applications

### Use Case 1: Command-Line Data Processing

Convert JSON files to TOON format from the command line:

```bash
# Using npx (no installation needed)
npx @toon-format/cli input.json -o output.toon

# Show token savings
npx @toon-format/cli data.json --stats -o output.toon

# Decode TOON back to JSON
npx @toon-format/cli data.toon -o output.json

# Pipe from stdin
cat customers.json | npx @toon-format/cli > customers.toon
```

---

### Use Case 2: Data Processing Pipeline

Reading JSON, converting to TOON, and writing output:

```javascript
import fs from 'fs';
import { encode } from '@toon-format/toon';

// Read JSON file
const jsonData = JSON.parse(fs.readFileSync('customers.json', 'utf-8'));

// Convert to TOON
const toonData = encode(jsonData, { delimiter: '\t', indent: 1 });

// Write to file
fs.writeFileSync('customers.toon', toonData, 'utf-8');

console.log('✓ Converted customers.json to customers.toon');
console.log(`Original size: ${JSON.stringify(jsonData).length} bytes`);
console.log(`Converted size: ${toonData.length} bytes`);
console.log(`Savings: ${Math.round((1 - toonData.length / JSON.stringify(jsonData).length) * 100)}%`);
```

---

### Use Case 3: Database Migration

Convert data while inserting into databases:

```javascript
import { encode, decode } from '@toon-format/toon';
import mongoose from 'mongoose';

// MongoDB schema
const recordSchema = new mongoose.Schema({
  originalJson: Object,
  compressedToon: String,
  savedSpace: Number
});

const Record = mongoose.model('Record', recordSchema);

async function saveOptimized(jsonData) {
  const toonData = encode(jsonData, { indent: 1 });
  
  const savings = ((1 - toonData.length / JSON.stringify(jsonData).length) * 100).toFixed(2);
  
  const record = new Record({
    originalJson: jsonData,
    compressedToon: toonData,
    savedSpace: savings
  });
  
  await record.save();
  console.log(`Saved with ${savings}% space efficiency`);
}

// Usage
saveOptimized({
  orders: [
    { orderId: 1001, customerId: 501, amount: 299.99, status: 'shipped' },
    { orderId: 1002, customerId: 502, amount: 149.99, status: 'pending' },
    // ... many more orders
  ]
});
```

---

## Express.js Integration: Building TOON-Optimized APIs

### Basic Setup: Express Server with TOON Endpoints

```javascript
import express from 'express';
import { encode, decode } from '@toon-format/toon';

const app = express();
app.use(express.json());

// Middleware to add TOON response capability
app.use((req, res, next) => {
  // Store original json method
  const originalJson = res.json.bind(res);
  
  // Override json to support TOON format
  res.json = function(data) {
    // If client requests TOON format via header or query
    if (req.query.format === 'toon' || req.headers['accept-format'] === 'toon') {
      const toonData = encode(data, { indent: 1 });
      res.setHeader('Content-Type', 'text/plain; charset=utf-8');
      res.send(toonData);
    } else {
      // Default JSON response
      originalJson(data);
    }
  };
  
  next();
});

// Example endpoint
app.get('/api/users', (req, res) => {
  const users = [
    { id: 1, name: 'Alice', email: 'alice@example.com', active: true },
    { id: 2, name: 'Bob', email: 'bob@example.com', active: true },
    { id: 3, name: 'Charlie', email: 'charlie@example.com', active: false }
  ];
  
  res.json({ users });
});

// Start server
app.listen(3000, () => console.log('Server on port 3000'));
```

**Usage:**
```bash
# Get response in JSON (default)
curl http://localhost:3000/api/users

# Get response in TOON format
curl "http://localhost:3000/api/users?format=toon"

# Or using header
curl -H "Accept-Format: toon" http://localhost:3000/api/users
```

---

### Advanced: LLM-Optimized API Endpoint

Create an endpoint specifically for LLM integration:

```javascript
import express from 'express';
import { encode } from '@toon-format/toon';
import fetch from 'node-fetch';

const app = express();
app.use(express.json());

// Endpoint to get data in TOON format for LLM APIs
app.post('/api/llm/data', async (req, res) => {
  const { query } = req.body;
  
  try {
    // Fetch data from database/API
    const data = await fetchDataFromSource(query);
    
    // Encode to TOON for maximum efficiency
    const toonData = encode(data, { 
      delimiter: '\t', 
      indent: 1 
    });
    
    // Return with metadata
    res.json({
      format: 'toon',
      data: toonData,
      originalTokens: Math.ceil(JSON.stringify(data).length / 4),
      optimizedTokens: Math.ceil(toonData.length / 4),
      savings: Math.round((1 - toonData.length / JSON.stringify(data).length) * 100)
    });
    
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// Send data directly to OpenAI with TOON format
app.post('/api/llm/chat', async (req, res) => {
  const { userMessage, dataContext } = req.body;
  
  // Encode context data to TOON
  const toonContext = encode(dataContext, { indent: 1 });
  
  // Build prompt with TOON context
  const systemPrompt = `You are an AI assistant analyzing structured data.
  
Context data (TOON format):
${toonContext}

Analyze this data and respond to user queries accurately.`;
  
  // Call OpenAI API
  const response = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`
    },
    body: JSON.stringify({
      model: 'gpt-4',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userMessage }
      ],
      temperature: 0.7
    })
  });
  
  const result = await response.json();
  res.json({
    tokensUsed: result.usage.total_tokens,
    estimatedCostSavings: (result.usage.total_tokens * 0.30 / 1000).toFixed(2),
    response: result.choices[0].message.content
  });
});

app.listen(3000, () => console.log('LLM-optimized API on port 3000'));
```

**Usage example with curl:**
```bash
# Get data in TOON format
curl -X POST http://localhost:3000/api/llm/data \
  -H "Content-Type: application/json" \
  -d '{"query": "get_customer_orders"}'

# Chat with LLM using TOON context
curl -X POST http://localhost:3000/api/llm/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userMessage": "What is the total revenue?",
    "dataContext": {"orders": [...]}
  }'
```

---

## Real-World Implementation: Analytics Dashboard

A complete example sending analytics data to Claude AI:

```javascript
import { encode } from '@toon-format/toon';

// 1. Fetch analytics data
async function getAnalyticsData(dateRange) {
  const analyticsData = {
    period: dateRange,
    dailyMetrics: [
      { date: '2025-01-01', sessions: 2450, users: 1203, pageViews: 8921, bounce: 0.35, ctr: 0.042 },
      { date: '2025-01-02', sessions: 2678, users: 1345, pageViews: 9801, bounce: 0.33, ctr: 0.045 },
      { date: '2025-01-03', sessions: 2334, users: 1098, pageViews: 8234, bounce: 0.38, ctr: 0.039 },
      // ... 27 more days
    ],
    topPages: [
      { path: '/home', views: 45231, avgTime: '2:34', exits: 0.12 },
      { path: '/products', views: 38921, avgTime: '3:12', exits: 0.08 },
      { path: '/blog', views: 24567, avgTime: '4:45', exits: 0.22 }
    ]
  };
  
  return analyticsData;
}

// 2. Prepare TOON format
async function prepareAnalyticsForLLM() {
  const data = await getAnalyticsData('2025-01-01 to 2025-01-30');
  
  // Encode with maximum efficiency
  const toonData = encode(data, { delimiter: '\t', indent: 1 });
  
  console.log('TOON-Formatted Analytics:');
  console.log(toonData);
  
  return toonData;
}

// 3. Send to Claude for analysis
async function analyzeWithClaude() {
  const analyticsData = await prepareAnalyticsForLLM();
  
  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': process.env.CLAUDE_API_KEY,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-3-5-sonnet-20241022',
      max_tokens: 1024,
      system: `You are an expert data analyst. Analyze the provided analytics data in TOON format and provide insights on:
1. Trends and patterns
2. Anomalies or concerning metrics
3. Recommendations for improvement`,
      messages: [
        {
          role: 'user',
          content: `Analyze this analytics data:\n\n${analyticsData}`
        }
      ]
    })
  });
  
  const result = await response.json();
  const analysis = result.content[0].text;
  
  // Calculate savings
  const jsonSize = JSON.stringify(await getAnalyticsData('2025-01-01 to 2025-01-30')).length;
  const toonSize = analyticsData.length;
  const savings = Math.round((1 - toonSize / jsonSize) * 100);
  
  console.log('\n=== Analysis Results ===');
  console.log(analysis);
  console.log(`\n=== Token Efficiency ===`);
  console.log(`JSON size: ${jsonSize} bytes`);
  console.log(`TOON size: ${toonSize} bytes`);
  console.log(`Space saved: ${savings}%`);
  console.log(`Estimated API cost: $${(result.usage.output_tokens * 0.003 / 1000).toFixed(4)}`);
}

// Run the analysis
analyzeWithClaude().catch(console.error);
```

---

## Performance Benchmarks & Optimization Tips

### Token Efficiency Benchmarks

| Data Type | Sample Size | JSON Tokens | TOON Tokens | Savings |
|-----------|------------|-------------|------------|---------|
| **Customer list** | 100 records | 4,890 | 1,845 | 62% |
| **Analytics (30 days)** | 30 records | 3,421 | 1,204 | 65% |
| **GitHub repos** | 500 repos | 89,234 | 51,345 | 42% |
| **Order history** | 250 orders | 12,450 | 5,123 | 59% |
| **Time-series data** | 365 days | 18,934 | 7,812 | 59% |

---

### Optimization Techniques

**1. Use tab delimiter for maximum savings:**
```javascript
const optimized = encode(data, { delimiter: '\t' });
// Typically saves additional 5-10% vs comma delimiter
```

**2. Flatten nested structures when possible:**
```javascript
// ❌ Less efficient (nested)
const nested = {
  user: { id: 1, profile: { name: 'Alice', email: 'alice@example.com' } }
};

// ✅ More efficient (flattened)
const flattened = {
  userId: 1,
  userName: 'Alice',
  userEmail: 'alice@example.com'
};

// TOON sees more structure in flattened data
```

**3. Ensure data uniformity for tabular format:**
```javascript
// ✅ Uniform (TOON tabular format - 50-60% savings)
const uniform = {
  items: [
    { id: 1, name: 'Item A', price: 29.99 },
    { id: 2, name: 'Item B', price: 39.99 },
    { id: 3, name: 'Item C', price: 49.99 }
  ]
};

// ❌ Non-uniform (TOON list format - 10-20% savings)
const nonUniform = {
  items: [
    { id: 1, name: 'Item A', price: 29.99 },
    { id: 2, name: 'Item B' }, // missing price
    { id: 3, name: 'Item C', price: 49.99, discount: '10%' } // extra field
  ]
};
```

**4. Use 1-space indentation for LLM APIs:**
```javascript
const compact = encode(data, { indent: 1 });
// Saves ~10% more tokens from whitespace
```

---

## Error Handling & Edge Cases

### Handling Encoding Errors

```javascript
import { encode } from '@toon-format/toon';

function safeEncode(data, options = {}) {
  try {
    if (!data) {
      throw new Error('Data is null or undefined');
    }
    
    if (typeof data !== 'object') {
      throw new Error('Data must be an object or array');
    }
    
    return encode(data, options);
    
  } catch (error) {
    console.error('TOON encoding failed:', error.message);
    
    // Fallback to JSON
    console.warn('Falling back to JSON format');
    return JSON.stringify(data);
  }
}

// Usage
const result = safeEncode({ users: [...] });
```

### Handling Decoding Errors

```javascript
import { decode } from '@toon-format/toon';

function safeDecode(toonString) {
  try {
    if (!toonString || typeof toonString !== 'string') {
      throw new Error('Invalid TOON input');
    }
    
    return decode(toonString);
    
  } catch (error) {
    console.error('TOON decoding failed:', error.message);
    
    // Try parsing as JSON fallback
    try {
      return JSON.parse(toonString);
    } catch {
      console.error('Could not parse as JSON either');
      return null;
    }
  }
}

// Usage
const data = safeDecode(toonString);
if (data) {
  // Process data
}
```

### Special Characters and Escaping

```javascript
import { encode } from '@toon-format/toon';

const dataWithSpecialChars = {
  messages: [
    { id: 1, text: 'Hello, World!' }, // contains comma
    { id: 2, text: 'Line1\nLine2' }, // contains newline
    { id: 3, text: 'Quote: "Important"' } // contains quotes
  ]
};

// TOON handles escaping automatically
const toon = encode(dataWithSpecialChars);
console.log(toon);
// Output will properly escape special characters
```

---

## Debugging & Monitoring TOON Usage

### Token Counting Utility

```javascript
import { encode } from '@toon-format/toon';

function compareFormats(data) {
  const jsonString = JSON.stringify(data);
  const toonString = encode(data, { indent: 1 });
  
  // Approximate token count (4 chars ≈ 1 token in GPT tokenizer)
  const jsonTokens = Math.ceil(jsonString.length / 4);
  const toonTokens = Math.ceil(toonString.length / 4);
  
  return {
    json: {
      bytes: jsonString.length,
      tokens: jsonTokens,
      cost: (jsonTokens * 0.03 / 1000).toFixed(4) // GPT-4 input pricing
    },
    toon: {
      bytes: toonString.length,
      tokens: toonTokens,
      cost: (toonTokens * 0.03 / 1000).toFixed(4)
    },
    savings: {
      bytes: Math.round((1 - toonString.length / jsonString.length) * 100) + '%',
      tokens: Math.round((1 - toonTokens / jsonTokens) * 100) + '%',
      cost: `$${(((jsonTokens - toonTokens) * 0.03 / 1000)).toFixed(4)}`
    }
  };
}

// Usage
const data = { customers: [/*...*/] };
const comparison = compareFormats(data);
console.log(comparison);
```

---

## Common Use Cases: Practical Examples

### Use Case 1: Customer Relationship Management (CRM)

```javascript
import { encode } from '@toon-format/toon';

const crmData = {
  customers: [
    { customerId: 'C001', name: 'Alice Corp', industry: 'Tech', revenue: 2500000, employees: 150 },
    { customerId: 'C002', name: 'Bob Services', industry: 'Finance', revenue: 5000000, employees: 300 },
    { customerId: 'C003', name: 'Charlie Inc', industry: 'Retail', revenue: 1200000, employees: 75 }
  ]
};

// Send to AI for market analysis
const toonData = encode(crmData, { indent: 1 });
// Use with Claude/GPT-4 for customer insights
```

---

### Use Case 2: E-Commerce Product Feed

```javascript
import { encode } from '@toon-format/toon';

const productFeed = {
  products: [
    { sku: 'SKU001', name: 'Laptop Pro', category: 'Electronics', price: 1299.99, stock: 45, rating: 4.8 },
    { sku: 'SKU002', name: 'USB-C Cable', category: 'Accessories', price: 12.99, stock: 500, rating: 4.5 },
    { sku: 'SKU003', name: 'Monitor 27"', category: 'Electronics', price: 399.99, stock: 28, rating: 4.6 }
  ]
};

const toon = encode(productFeed, { delimiter: '\t', indent: 1 });
// Send to LLM for product recommendations, price optimization
```

---

### Use Case 3: Application Logs for AI Analysis

```javascript
import { encode } from '@toon-format/toon';

const appLogs = {
  events: [
    { timestamp: '2025-01-01T10:00:00Z', level: 'INFO', service: 'auth', message: 'User login' },
    { timestamp: '2025-01-01T10:01:00Z', level: 'ERROR', service: 'database', message: 'Connection timeout' },
    { timestamp: '2025-01-01T10:02:00Z', level: 'WARNING', service: 'api', message: 'High response time' }
  ]
};

const toon = encode(appLogs);
// Send to Claude for anomaly detection and troubleshooting
```

---

## Frequently Asked Questions (FAQ)

### Q1: Should I always use TOON instead of JSON?

**A:** No. Use TOON when:
- ✅ Sending data to LLMs (token cost matters)
- ✅ Data is uniform arrays (100+ similar objects)
- ✅ You need token efficiency

Use JSON when:
- ✅ Building REST APIs (client compatibility)
- ✅ Data is deeply nested
- ✅ Objects have varying fields

---

### Q2: Does TOON support all JavaScript data types?

**A:** TOON supports primitives (strings, numbers, booleans, null) and structure (objects, arrays). Special handling:

| Type | Behavior |
|------|----------|
| **Date** | Converted to ISO string |
| **BigInt** | Converted to decimal string |
| **undefined** | Encoded as null |
| **NaN, Infinity** | Encoded as null |
| **Functions, Symbols** | Encoded as null |

---

### Q3: Can I use TOON with TypeScript?

**A:** Yes! The `@toon-format/toon` package includes TypeScript definitions:

```typescript
import { encode, decode } from '@toon-format/toon';

interface User {
  id: number;
  name: string;
  email: string;
}

const users: User[] = [
  { id: 1, name: 'Alice', email: 'alice@example.com' }
];

const toon: string = encode({ users });
const decoded: any = decode(toon);
```

---

### Q4: What's the performance impact of using TOON?

**A:** Minimal:
- **Encoding:** ~120µs (negligible)
- **Decoding:** ~150µs (negligible)
- **Token savings:** 30-60% (major)

The token cost savings vastly outweigh parsing overhead.

---

### Q5: How do I handle errors in production?

**A:** Use the error handling pattern shown earlier with fallback to JSON:

```javascript
function encodeWithFallback(data) {
  try {
    return { format: 'toon', data: encode(data) };
  } catch (error) {
    console.error('TOON encoding failed, using JSON:', error);
    return { format: 'json', data: JSON.stringify(data) };
  }
}
```

---

## Conclusion: Building TOON-Optimized JavaScript Applications

By integrating TOON format into your JavaScript applications, you can:

✅ **Reduce LLM API costs by 30-60%** — Direct savings on your monthly bill
✅ **Improve LLM accuracy by 4-7%** — Better comprehension with explicit structure
✅ **Speed up inference** — Fewer tokens = faster responses
✅ **Build scalable AI features** — Cost-efficient integration with Claude, GPT-4, Gemini
✅ **Maintain compatibility** — Round-trip conversion between JSON and TOON

### Next Steps

1. **Install the library:** `npm install @toon-format/toon`
2. **Try the basics:** Run the test file from Step 3
3. **Integrate into Express:** Add TOON endpoints to your API
4. **Measure impact:** Compare JSON vs TOON token usage
5. **Scale gradually:** Start with highest-volume LLM integrations

### Resources

- **Official GitHub:** github.com/toon-format/toon
- **NPM Package:** npmjs.com/package/@toon-format/toon
- **Interactive Converter:** toonifyit.com/converter
- **Full Specification:** toon-format documentation

---

## Related Articles

- **How to Convert JSON to TOON: Step-by-Step Tutorial**
- **TOON vs JSON vs YAML: Complete Comparison Guide**
- **TOON Format for ChatGPT: Optimize API Costs**
- **TOON Format for Python Developers**
- **Building TOON-Optimized RAG Systems**
- **TOON Format Performance Benchmarks 2025**

---

**Meta Description:** Learn TOON format for JavaScript. Complete guide to implementing @toon-format/toon in Node.js and Express.js. Reduce LLM token costs by 30-60% with working code examples.

**Keywords Targeted:**
- TOON format JavaScript implementation
- how to use TOON in Node.js
- TOON JavaScript library
- implement TOON encoder JavaScript
- json to toon converter
- json to toon
- toon format
- TOON for Express.js
- Node.js TOON format
- LLM data format optimization JavaScript
- reduce token costs JavaScript